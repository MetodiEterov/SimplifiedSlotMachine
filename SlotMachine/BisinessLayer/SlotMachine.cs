// <auto-generated />
namespace SlotMachine.BisinessLayer
{
  using global::SlotMachine.Common;
  using global::SlotMachine.Models;
  using System;
  using System.Collections.Generic;
  using System.Linq;

  /// <summary>
  /// SlotMachine
  /// </summary>
  public class SlotMachine : ISlotMachine
  {
    /// <summary>
    /// AllEqual
    /// </summary>
    /// <param name="values"></param>
    /// <returns></returns>
    public bool AllEqual(params double[] values)
    {
      if (values == null || values.Length == 0)
      {
        return true;
      }

      return values.All(v => v.Equals(values[0]));
    }

    /// <summary>
    /// CalculateProfit
    /// </summary>
    /// <param name="bet"></param>
    public void CalculateProfit(ref SlotMachineModel bet)
    {
      double profit = 0;

      foreach (var item in bet.Sources)
      {
        double sum = Math.Round(this.SumCoefficents(item), 2);

        switch (sum)
        {
          case 0.4:
          case 0.6:
          case 0.8:
          case 2.4:
            profit += sum * bet.Bet;
            break;

          case 1.2:
            if (new List<double> { item.LeftCoefficent, item.MiddleCoefficent, item.RightCoefficent }.Find(x => x == 0.8) != 0.8)
            {
              profit += sum * bet.Bet;
            }
            break;

          case 1.8:
            if ((this.AllEqual(item.LeftCoefficent, item.MiddleCoefficent, item.RightCoefficent)))
            {
              profit += sum * bet.Bet;
            }
            break;

          case 1.6:
            if (new List<double> { item.LeftCoefficent, item.MiddleCoefficent, item.RightCoefficent }.Find(x => x == 0.4) != 0.4)
            {
              profit += sum * bet.Bet;
            }
            break;

          default:
            break;
        }

      }

      bet.Won = Math.Round(profit, 2);
    }

    /// <summary>
    /// GetNewBettingCoefficents
    /// </summary>
    /// <returns></returns>
    public SlotMachineModel GetNewBettingCoefficents()
    {
      SlotMachineModel imageSources = new SlotMachineModel();
      for (int i = 0; i < Constants.rowsNumber; i++)
      {
        int leftCoefficent = this.GetRandomNumberInRange();
        int leftSource = Constants.SymbolCoefficents.IndexOf(Constants.SymbolWeights[leftCoefficent]);

        int middleCoefficent = this.GetRandomNumberInRange();
        int middleSource = Constants.SymbolCoefficents.IndexOf(Constants.SymbolWeights[middleCoefficent]);

        int rightCoefficent = this.GetRandomNumberInRange();
        int rightSource = Constants.SymbolCoefficents.IndexOf(Constants.SymbolWeights[rightCoefficent]);

        ImageEntity source = new ImageEntity
        {
          LeftSource = Constants.SymbolImageSources[leftSource],
          LeftCoefficent = Constants.SymbolWeights[leftCoefficent],
          MiddleSource = Constants.SymbolImageSources[middleSource],
          MiddleCoefficent = Constants.SymbolWeights[middleCoefficent],
          RightSource = Constants.SymbolImageSources[rightSource],
          RightCoefficent = Constants.SymbolWeights[rightCoefficent]
        };

        imageSources.Sources[i] = source;
      }

      return imageSources;
    }

    /// <summary>
    /// GetRandomNumberInRange
    /// </summary>
    /// <returns></returns>
    public int GetRandomNumberInRange()
    {
      Random random = new Random();
      return random.Next(0, Constants.SymbolWeights.Count);
    }

    /// <summary>
    /// SumCoefficents
    /// </summary>
    /// <param name="coefficents"></param>
    /// <returns></returns>
    public double SumCoefficents(ImageEntity coefficents)
    {
      return coefficents.LeftCoefficent + coefficents.MiddleCoefficent + coefficents.RightCoefficent;
    }
  }
}
